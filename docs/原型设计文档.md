# 细胞分割追踪系统 - 网页原型文字描述

## 一、整体架构

系统采用单页应用（SPA）架构，核心流程为：**上传 → 处理 → 可视化分析**。界面分为三大主模块：上传模块、处理监控模块、数据分析模块。导航栏固定顶部，支持模块间快速切换。

---

## 二、全局导航与布局

### 顶部导航栏
- **左侧**：系统Logo（细胞分裂图标 + "CellTracker Pro"文字）
- **中部**：流程指示器（上传 → 处理 → 分析），当前步骤高亮显示，已完成步骤显示勾选标记
- **右侧**：用户头像下拉菜单（历史记录、设置、帮助、退出）

### 全局状态栏（底部固定）
- 左侧：当前任务状态（空闲/处理中/已完成）
- 中部：系统消息提示区（自动消失的通知）
- 右侧：网络连接状态、当前时间

---

## 三、模块一：视频上传中心

### 3.1 主上传区域
**中央大区域**，初始状态显示：
- 虚线边框拖拽区域（尺寸：占视口高度60%）
- 中央图标：云上传图标 + "拖拽显微视频至此处"文字
- 次级按钮："点击浏览文件"
- 支持格式提示条：MP4、AVI、MOV、TIFF序列（最大2GB）

**拖拽悬停状态**：边框变为实线蓝色，背景出现淡蓝色遮罩，图标动画放大

**上传中状态**：
- 圆形进度环（中心显示百分比）
- 文件名、已上传大小/总大小
- 预估剩余时间
- 取消上传按钮（右上角）

### 3.2 文件信息面板（上传完成后右侧滑出）
- 视频缩略图预览（首帧）
- 基础信息列表：
  - 文件名
  - 文件大小
  - 视频时长
  - 分辨率（宽×高）
  - 帧率（fps）
  - 总帧数
- 质量检查标记（绿色勾选/黄色警告）
- "开始分析"主按钮（蓝色，大尺寸）

### 3.3 近期文件列表（底部区域）
- 横向滚动卡片列表
- 每张卡片显示：缩略图、文件名、上传时间、处理状态标签（未处理/处理中/已完成）
- 点击快速加载历史任务

---

## 四、模块二：处理监控中心

### 4.1 处理状态仪表盘（顶部区域）
**三列布局**：

| 左列 | 中列 | 右列 |
|-----|------|------|
| 当前处理帧数 / 总帧数（大数字显示） | 线性进度条（带百分比） | 预估剩余时间 |
| 处理速度（fps） | 阶段标签：预处理/分割/追踪/后处理 | 暂停/恢复按钮 |

### 4.2 双视频对比播放器（核心区域）
**左右分栏布局**（可切换为单视图）：

**左侧：原始视频**
- 视频播放区（深色背景）
- 底部控制栏：
  - 播放/暂停按钮
  - 逐帧前进/后退按钮
  - 时间轴滑块（显示当前帧号）
  - 速度选择器（0.5x/1x/2x/4x）
  - 全屏按钮
- 帧号显示（右下角）：当前帧 / 总帧数

**右侧：标注视频（实时生成）**
- 视频播放区（叠加分割掩膜和追踪ID）
- 图例说明：不同颜色代表不同细胞ID
- 追踪轨迹开关（显示/隐藏运动轨迹线）
- 细胞ID标签开关

**对比模式控制**（顶部工具栏）：
- 视图切换：左右对比 / 上下对比 / 画中画 / 仅原始 / 仅标注
- 同步播放开关（默认开启，确保两视频帧同步）

### 4.3 实时细胞列表面板（右侧边栏，可收起）
- 当前帧检测到的细胞列表
- 每行显示：颜色块 + 细胞ID + 置信度百分比
- 点击细胞行 → 视频中高亮对应细胞
- 筛选器：按面积范围、按置信度阈值

### 4.4 处理日志面板（底部可展开区域）
- 时间戳日志流
- 日志级别：信息（白）/ 警告（黄）/ 错误（红）
- 展开/收起按钮

---

## 五、模块三：数据分析中心（核心模块）

### 5.1 数据总览仪表板（顶部固定区域）
**四宫格指标卡**：

| 指标卡1 | 指标卡2 | 指标卡3 | 指标卡4 |
|--------|--------|--------|--------|
| 检测细胞总数 | 平均追踪时长 | 总分析帧数 | 视频总时长 |
| 数字大字体 | 数字 + 单位（分钟） | 数字 + fps | 数字 + 时间格式 |

下方快捷操作栏：
- "导出全部数据"下拉按钮（CSV/JSON/Excel）
- "下载标注视频"按钮
- "生成报告"按钮
- 时间范围选择器（分析整个视频或指定片段）

---

### 5.2 细胞选择与追踪面板（左侧边栏，宽度可调）

**细胞列表区**：
- 搜索框（按ID搜索）
- 排序选项：按ID / 按首次出现帧 / 按追踪时长 / 按平均速度
- 细胞卡片列表：
  - 缩略图（细胞轮廓）
  - 细胞ID（大号字体）
  - 关键统计：平均速度、总移动距离、出现帧数范围
  - 复选框（多选支持）
  - 收藏星标

**选中细胞详情（点击后展开）**：
- 基础信息：ID、首次出现帧、最后出现帧、存活时长
- 形态统计：平均面积、平均周长、平均圆形度、平均长宽比
- 运动统计：总位移、平均速度、最大速度、运动方向性评分
- 操作按钮："在视频中定位"、"单独分析"、"导出该细胞数据"

**追踪控制区**：
- "添加追踪"按钮（激活后在视频上框选）
- 当前追踪列表（显示已选细胞ID）
- 颜色分配指示器（自动分配区分色）
- "清除全部追踪"按钮

---

### 5.3 可视化图表区（核心主区域，标签页布局）

#### 标签页1：形态学特征分析（对应图1、图3）

**子区域A：形态参数分布（图3内容）**
- 2×2图表矩阵
- 每个子图包含：
  - 标题：周长分布 / 面积分布 / 圆形度分布 / 长宽比分布
  - 直方图（带拟合曲线）
  - X轴标签（带单位）
  - Y轴：频率百分比
  - 样本量标注（N=xxxx）
- 全局控制：分组选择（全部细胞/正常/氧化应激，如适用）

**子区域B：形态时序变化（图1内容）**
- 双图表并排：
  - 左图：圆形度时序（24小时）
  - 右图：长宽比时序（24小时）
- 每个图表结构：
  - 顶部：群体分布直方图（横向，概率密度）
  - 底部：5条代表性细胞时序折线（不同颜色）
  - X轴：时间（小时）
  - Y轴：参数值
- 交互功能：
  - 悬停显示具体数值
  - 点击图例隐藏/显示特定细胞线
  - 缩放时间范围

---

#### 标签页2：运动轨迹分析（对应图4、图5a）

**子区域A：三维时空轨迹（图4内容）**
- 主视图：3D散点线图（使用Three.js或Plotly）
- 坐标轴：
  - X轴：X位置（μm）
  - Y轴：Y位置（μm）
  - Z轴：时间（小时，0-20）
- 视觉元素：
  - 每条轨迹不同颜色
  - 轨迹线透明度0.7
  - 起点标记（圆点）、终点标记（箭头）
- 右侧2D投影图（原点归一化）：
  - 同心圆网格（80μm、160μm）
  - 轨迹起点对齐中心
  - 正常组与应激组分图或分色显示
- 控制面板：
  - 旋转/平移/缩放控制
  - 轨迹选择器（显示/隐藏特定细胞）
  - 时间范围滑块（动态裁剪显示）

**子区域B：二维轨迹总览（图5a内容）**
- 极坐标风格轨迹图
- 左右对比：正常组（N=271）vs 应激组（N=207）
- 每个细胞轨迹从中心出发，保持原始方向
- 同心圆距离标尺（200μm、400μm、600μm）
- 透明度叠加显示密度

---

#### 标签页3：运动动力学分析（对应图5c）

**子区域：多参数时序图（图5c内容）**
- 4×2图表矩阵（左列正常组，右列应激组）
- 行1：圆形度时序
  - Y轴：0-0.8
  - 平滑曲线
- 行2：圆形度增量（ΔCircularity）
  - Y轴：-0.2至0.2
  - 显示变化率
- 行3：速度时序
  - Y轴：0-6 μm/min
  - 突出峰值事件
- 行4：转向角时序
  - Y轴：0-150度
  - 显示方向变化剧烈程度
- X轴统一：时间（分钟，0-360）
- 每组图表顶部标注分组名称（绿色=Normal，蓝色=Oxidative Stress）

---

#### 标签页4：行为模式分析（对应图5b）

**子区域A：行为模式示意图（图5b内容）**
- 四个象限布局：
  - I象限：快速定向迁移（Fast directional migration）
    - 轨迹特征：长而直的箭头
  - II象限：快速角度变化（Fast angular variation）
    - 轨迹特征：频繁转向的锯齿线
  - III象限：低速定向迁移（Low directional migration）
    - 轨迹特征：短而直的箭头
  - IV象限：持续转向（Persistent turning）
    - 轨迹特征：平滑曲线
- 每个象限包含：
  - 示意图（抽象轨迹）
  - 关键参数标注（速度范围、转向角范围）
  - 该模式细胞数量统计

**子区域B：行为分类散点图**
- X轴：平均速度
- Y轴：转向频率
- 散点颜色：四分类颜色编码
- 悬停显示细胞ID和具体参数

---

#### 标签页5：细胞间相互作用

**子区域A：最近邻距离热图**
- X轴：时间
- Y轴：细胞ID
- 颜色深度：距离值（深蓝=近，浅黄=远）
- 识别聚集事件（距离持续低于阈值）

**子区域B：细胞碰撞事件时间线**
- 水平时间轴
- 垂直线标记碰撞事件
- 点击事件显示参与细胞ID和位置

---

#### 标签页6：自定义分析

**灵活图表构建器**：
- 数据源选择器（X轴、Y轴、颜色、大小）
- 图表类型选择：散点/折线/柱状/箱线/热力图/3D散点
- 筛选条件设置（时间范围、细胞子集）
- 实时预览
- 保存自定义图表模板

---

### 5.4 视频联动播放器（图表区下方固定区域）

**紧凑播放器**：
- 窄条时间轴（显示全视频长度）
- 播放控制按钮组（播放/暂停/逐帧）
- 当前时间显示
- 与上方图表联动：图表中的时间选择器同步控制视频帧

**同步交互**：
- 在图表中框选时间范围 → 视频循环播放该片段
- 点击轨迹图中某点 → 视频跳转至对应帧并高亮该细胞
- 视频暂停时 → 所有图表显示对应时间点的垂直指示线

---

## 六、数据导出中心（侧边滑出面板）

### 触发方式
- 各模块的"导出"按钮
- 快捷键Ctrl+E

### 面板内容
**导出格式选择**：
- 数据文件：CSV（表格）、JSON（原始）、Excel（多工作表）
- 视频文件：MP4（H.264）、AVI、GIF（短片段）
- 图表：PNG（高分辨率）、SVG（矢量）、PDF（报告用）

**内容选择器**：
- 复选框列表：原始数据、标注视频、各类型图表、完整分析报告
- 批量选择：全选/仅选中细胞/仅当前视图

**高级选项**：
- 分辨率设置（视频/图片）
- 数据精度（小数位数）
- 是否包含元数据（处理参数、时间戳）

**导出队列**：
- 显示待导出项目列表
- 进度条和预计完成时间
- 下载按钮（完成后激活）

---

## 七、设置与配置面板

### 7.1 模型参数设置（高级用户）
- 分割置信度阈值（滑块 0-1）
- 追踪IOU阈值（滑块 0-1）
- 最小细胞面积（数值输入）
- 最大追踪距离（像素值）
- 帧间插值开关

### 7.2 显示设置
- 主题切换：浅色/深色/跟随系统
- 图表配色方案：学术蓝/高对比/色盲友好
- 语言选择：中文/English
- 默认播放速度
- 轨迹显示长度（帧数）

### 7.3 快捷键设置
- 可自定义键盘快捷键列表
- 恢复默认按钮

---

## 八、响应式适配规则

### 大屏幕（>1600px）
- 三栏布局：左侧细胞列表面板（固定宽） + 中央图表区（自适应） + 右侧属性面板（固定宽）
- 视频播放器默认左右对比模式

### 中屏幕（1200-1600px）
- 双栏布局：左侧细胞列表（可收起） + 中央主区域
- 图表改为2×2网格

### 平板（768-1200px）
- 单栏布局，面板改为底部抽屉式
- 视频播放器默认单视图，切换按钮浮动

### 手机（<768px）
- 简化视图，仅保留核心播放和数据查看
- 图表改为轮播卡片式
- 导出功能简化

---

## 九、交互状态与反馈

### 加载状态
- 骨架屏（内容区域灰色占位块）
- 旋转加载图标（操作按钮内）
- 进度条（长时间操作）

### 空状态
- 上传前：引导插画 + 操作提示
- 无选中细胞：提示选择细胞以查看详情
- 处理中：实时日志流 + 取消选项

### 错误处理
- 顶部横幅通知（非阻塞）
- 详细错误信息折叠面板
- 一键重试按钮
- 联系支持链接

### 成功反馈
- 绿色勾选动画
- 自动消失的通知条
- 成就徽章（首次完成分析等）

---

## 十、关键交互流程描述

### 流程1：首次分析完整流程
1. 用户进入上传中心，拖拽视频文件
2. 系统验证格式，显示预览和元数据
3. 用户点击"开始分析"，跳转处理中心
4. 处理中心显示双视频对比，右侧实时生成标注
5. 处理完成，系统自动跳转数据分析中心
6. 数据分析中心默认显示"形态学特征分析"标签
7. 用户点击左侧细胞列表中的某个细胞
8. 所有图表高亮该细胞轨迹，视频跳转至首次出现帧
9. 用户切换至"运动轨迹分析"标签查看3D轨迹
10. 用户框选时间范围，视频循环播放该片段
11. 用户点击"导出"，选择CSV和MP4，下载结果

### 流程2：历史数据快速查看
1. 用户点击顶部导航"历史记录"
2. 下拉显示近期任务列表
3. 点击历史任务，直接跳转数据分析中心
4. 系统加载已处理数据，无需重新计算
5. 用户切换不同标签页查看各类图表

# 南大方面要求的四张图表的详细说明如下：

## 图1: 细胞形态学特征时序分析 (Figure 4)

### 图表意义
这张图展示了**正常HT22细胞**与**氧化应激HT22细胞**在24小时内的形态学特征变化对比：
- **左侧直方图**：展示所有采集细胞的特征分布（圆形度/长宽比）
- **右侧折线图**：展示5个代表性单个细胞的时间序列变化

### 绘制所需数据

| 数据维度 | 具体字段 |
|---------|---------|
| 时间序列 | `frame_number` / `time_h` (0-24小时) |
| 形态特征 | `circularity` (圆形度, 0-1) |
| 形态特征 | `aspect_ratio` (长宽比) |
| 分组标识 | `group` (Normal/Oxidative Stress) |
| 细胞标识 | `cell_id` |
| 样本统计 | 总样本量 N=7529 (正常) / N=11332 (应激) |

### 可视化特点
- **双视图设计**：群体分布 + 个体时序
- **颜色编码**：绿色=正常细胞，蓝色=氧化应激细胞
- **科学对比**：直观展示氧化应激对细胞形态动态变化的影响

---

## 图2: 细胞迁移行为综合分析 (Figure 5)

### 图表意义
这是**细胞运动行为的多维度可视化**，包含三个层次：
- **(a) 归一化轨迹图**：展示细胞群体从起点出发的运动范围差异
- **(b) 行为模式示意图**：归纳四种典型迁移模式（快速定向、快速转向、低速定向、持续转向）
- **(c) 多参数时序图**：圆形度、圆形度增量、速度、转向角的360分钟连续监测

### 绘制所需数据

| 子图 | 所需数据 |
|-----|---------|
| **(a) 轨迹图** | `normalized_x`, `normalized_y` (起点归一化坐标), `cell_id`, `group` |
| **(b) 模式图** | 基于速度、转向角、持续时间的**行为分类标签** |
| **(c) 时序图** | `circularity`, `delta_circularity`, `velocity_um_min`, `turning_angle`, `time_min` |

### 关键计算指标
```python
# 速度计算
velocity = sqrt(vx² + vy²)  # μm/min

# 转向角计算
turning_angle = arctan2(vy_t, vx_t) - arctan2(vy_t-1, vx_t-1)

# 圆形度增量
delta_circularity = circularity[t] - circularity[t-1]
```

---

## 图3: 形态参数正态分布 (Figure 3)

### 图表意义
展示HT22细胞在微芯片表面贴壁生长的**静态形态学特征分布**，验证数据是否符合正态分布假设。

### 绘制所需数据

| 子图 | 数据字段 | 单位 |
|-----|---------|------|
| **(a) 周长** | `perimeter` | μm |
| **(b) 面积** | `area` | μm² |
| **(c) 圆形度** | `circularity` | 无单位 (0-1) |
| **(d) 长宽比** | `aspect_ratio` | 无单位 |

### 统计信息
- 总分析细胞数：N = 4141
- 包含直方图 + 核密度估计曲线（正态分布拟合）

---

## 图4: 三维细胞轨迹与原点归一化 (Figure 4)

### 图表意义
展示细胞在**三维时空空间**中的运动轨迹：
- **左侧3D图**：X-Y位置 + 时间轴Z的三维轨迹
- **右侧2D极坐标图**：从细胞起始点归一化后的运动范围（同心圆表示距离）

### 绘制所需数据

| 维度 | 数据字段 |
|-----|---------|
| 空间 | `x_position_um`, `y_position_um` |
| 时间 | `time_h` (0-20小时) |
| 归一化 | `normalized_x = x - x_start`, `normalized_y = y - y_start` |
| 分组 | `condition` (Normal/Oxidative Stress) |

### 可视化洞察
- **正常细胞(a)**：运动范围大，轨迹分散（探索性行为）
- **应激细胞(b)**：运动受限，轨迹聚集（应激导致的运动抑制）
